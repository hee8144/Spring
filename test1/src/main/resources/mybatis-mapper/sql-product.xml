<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.ProductMapper">

	<select id="selectProductList" parameterType="hashmap" resultType="com.example.test1.model.Product">
		SELECT * FROM TBL_FOOD F
		INNER JOIN TBL_FOOD_IMG I ON F.FOOD_NO = I.FOOD_NO
		WHERE 1=1
		<if test="keyWord != null and keyWord !=''">
			AND FOOD_NAME LIKE '%' || #{keyWord} || '%' OR FOOD_INFO LIKE '%' || #{keyWord} || '%'
		</if>
		
		<if test="part !=null and part !=''">
			AND MENU_PART = #{part}
		</if>
		
		<if test="menuNo !=null and menuNo !='' ">
			AND MENU_No = #{menuNo}
		</if>
		
	</select>
	
	
	<select id="selectMenuList" parameterType="hashmap" resultType="com.example.test1.model.Menu">
		SELECT M.*, NVL(CNT,0) AS CNT 
		FROM TBL_MENU M
		LEFT JOIN (
		SELECT MENU_PART ,COUNT(MENU_PART) AS CNT
		FROM TBL_MENU M1
		GROUP BY MENU_PART
		)R ON M.MENU_NO = R.MENU_PART
		
		<if test="depth !=null and depth !='' ">
			WHERE DEPTH = #{depth}
		</if>
	</select>

	<select id="selectProduct" parameterType="hashmap" resultType="com.example.test1.model.Product">
		SELECT * FROM TBL_FOOD
		WHERE FOOD_NO = #{foodNo}
	</select>

	<select id="selectProductImg" parameterType="hashmap" resultType="com.example.test1.model.Product">
		SELECT * FROM TBL_FOOD_IMG
		WHERE FOOD_NO = #{foodNo}
	</select>
	<insert id="addFood" parameterType="hashmap" useGeneratedKeys="true" keyColumn="FOOD_NO" keyProperty="foodNo">
		INSERT INTO TBL_FOOD VALUES(FOOD_SEQ.NEXTVAL, #{foodName},#{price},#{foodKind},#{foodInfo},'Y',#{menuNo},#{menuPart})
	</insert>
	
	<insert id="insertFoodImg" parameterType="hashmap">
		INSERT INTO TBL_FOOD_IMG VALUES(FOODFILE_SEQ.NEXTVAL , #{foodNo} , #{path} , #{filename} , #{orgName} , #{size} , #{ext},'Y')
	</insert>
	
	
	
	
</mapper>




